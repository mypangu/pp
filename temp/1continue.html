<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Continue Watching - PanguPlay</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
      background: #121212;
      color: #fff;
      min-height: 100vh;
      padding-bottom: 60px;
    }

    /* Navbar Styles */
    .navbar {
      position: sticky;
      top: 0;
      background: rgba(18, 18, 18, 0.95);
      backdrop-filter: blur(10px);
      padding: 12px 20px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      z-index: 1000;
      border-bottom: 1px solid #333;
    }

    .nav-left {
      display: flex;
      align-items: center;
      gap: 15px;
    }

    .menu-icon {
      font-size: 24px;
      cursor: pointer;
      display: none;
    }

    .nav-logo {
      font-size: 24px;
      font-weight: bold;
      color: #ff4500;
      text-decoration: none;
    }

    .nav-center {
      display: flex;
      gap: 25px;
    }

    .nav-center a {
      color: #fff;
      text-decoration: none;
      transition: color 0.3s;
      font-size: 15px;
    }

    .nav-center a:hover,
    .nav-center a[selected] {
      color: #ff4500;
    }

    .search-bar {
      position: relative;
    }

    .search-bar input {
      padding: 8px 35px 8px 15px;
      border-radius: 20px;
      border: 1px solid #333;
      background: #1e1e1e;
      color: #fff;
      width: 250px;
      outline: none;
    }

    #clearButton {
      position: absolute;
      right: 10px;
      top: 50%;
      transform: translateY(-50%);
      background: none;
      border: none;
      color: #fff;
      cursor: pointer;
      display: none;
    }

    .mobile-backdrop {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.7);
      z-index: 999;
    }

    .mobile-menu {
      position: fixed;
      top: 0;
      left: -280px;
      width: 280px;
      height: 100%;
      background: #1e1e1e;
      z-index: 1001;
      transition: left 0.3s;
      padding: 20px;
      overflow-y: auto;
    }

    .mobile-menu.active {
      left: 0;
    }

    .close-btn {
      position: absolute;
      top: 15px;
      right: 15px;
      background: none;
      border: none;
      color: #fff;
      font-size: 24px;
      cursor: pointer;
    }

    .mobile-menu a {
      display: block;
      color: #fff;
      text-decoration: none;
      padding: 15px 0;
      border-bottom: 1px solid #333;
      transition: color 0.3s;
    }

    .mobile-menu a:hover {
      color: #ff4500;
    }

    /* Page Header */
    .page-header {
      padding: 30px 20px 20px;
      max-width: 1400px;
      margin: 0 auto;
    }

    .page-header h1 {
      font-size: 32px;
      margin-bottom: 8px;
    }

    .page-header p {
      color: #aaa;
      font-size: 14px;
    }

    /* Content Container */
    .content-container {
      max-width: 1400px;
      margin: 0 auto;
      padding: 20px;
    }

    /* Empty State */
    .empty-state {
      text-align: center;
      padding: 60px 20px;
    }

    .empty-state i {
      font-size: 80px;
      color: #333;
      margin-bottom: 20px;
    }

    .empty-state h2 {
      font-size: 24px;
      margin-bottom: 10px;
      color: #999;
    }

    .empty-state p {
      color: #666;
      margin-bottom: 20px;
    }

    .empty-state a {
      display: inline-block;
      padding: 12px 30px;
      background: #ff4500;
      color: #fff;
      text-decoration: none;
      border-radius: 25px;
      transition: background 0.3s;
    }

    .empty-state a:hover {
      background: #ff5722;
    }

    /* Continue Watching Grid */
    .continue-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
      gap: 20px;
      margin-top: 20px;
    }

    .continue-card {
      background: #1e1e1e;
      border-radius: 12px;
      overflow: hidden;
      cursor: pointer;
      transition: transform 0.3s, box-shadow 0.3s;
      position: relative;
    }

    .continue-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 8px 16px rgba(0, 0, 0, 0.3);
    }

    .card-image {
      position: relative;
      padding-top: 150%;
      overflow: hidden;
      background: #000;
    }

    .card-image img {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    .play-overlay {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      width: 60px;
      height: 60px;
      background: rgba(255, 69, 0, 0.9);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      opacity: 0;
      transition: opacity 0.3s;
    }

    .continue-card:hover .play-overlay {
      opacity: 1;
    }

    .play-overlay i {
      font-size: 24px;
      margin-left: 3px;
    }

    .progress-bar-container {
      position: absolute;
      bottom: 0;
      left: 0;
      right: 0;
      height: 4px;
      background: rgba(255, 255, 255, 0.2);
    }

    .progress-bar-fill {
      height: 100%;
      background: #ff4500;
      transition: width 0.3s;
    }

    .card-content {
      padding: 15px;
    }

    .card-title {
      font-size: 16px;
      font-weight: 600;
      margin-bottom: 5px;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .card-info {
      display: flex;
      justify-content: space-between;
      align-items: center;
      color: #aaa;
      font-size: 13px;
    }

    .remove-btn {
      position: absolute;
      top: 10px;
      right: 10px;
      width: 32px;
      height: 32px;
      background: rgba(0, 0, 0, 0.8);
      border: none;
      border-radius: 50%;
      color: #fff;
      cursor: pointer;
      display: none;
      align-items: center;
      justify-content: center;
      transition: background 0.3s;
      z-index: 10;
    }

    .continue-card:hover .remove-btn {
      display: flex;
    }

    .remove-btn:hover {
      background: #ff4500;
    }

    /* Footer */
    footer {
      text-align: center;
      padding: 20px;
      color: #666;
      border-top: 1px solid #333;
      margin-top: 40px;
    }

    /* Loader */
    .loader {
      width: 40px;
      height: 40px;
      border: 4px solid #ffffff33;
      border-top: 4px solid #ffffff;
      border-radius: 50%;
      animation: spin 1s linear infinite;
      margin: 40px auto;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    /* Mobile Responsive */
    @media (max-width: 768px) {
      .menu-icon {
        display: block;
      }

      .nav-center {
        display: none;
      }

      .search-bar input {
        width: 180px;
      }

      .page-header h1 {
        font-size: 24px;
      }

      .continue-grid {
        grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));
        gap: 15px;
      }

      .card-title {
        font-size: 14px;
      }

      .card-info {
        font-size: 12px;
      }
    }

    @media (max-width: 480px) {
      .continue-grid {
        grid-template-columns: repeat(2, 1fr);
        gap: 12px;
      }

      .page-header {
        padding: 20px 15px 15px;
      }

      .content-container {
        padding: 15px;
      }
    }
  </style>
</head>
<body>
  <!-- Splash Screen -->
  <div id="splash-screen" style="position:fixed;top:0;left:0;width:100%;height:100%;background:#121212;display:none;flex-direction:column;justify-content:center;align-items:center;z-index:9999;">
    <img src="favicon.png" alt="Loading..." style="width:100px;height:auto;margin-bottom:20px;">
    <div class="loader"></div>
  </div>

  <!-- Navbar -->
  <div class="navbar">
    <div class="nav-left">
      <div class="menu-icon" onclick="toggleMenu()">&#9776;</div>
      <a href="index.html" class="nav-logo">PanguPlay</a>
    </div>
    <div class="nav-center nav-links">
      <a href="index.html">Home</a>
      <a href="movies.html">Movies</a>
      <a href="shows.html">Shows</a>
      <a href="dubbed.html">Tamil Dub</a>
      <a href="continue.html" selected>Continue...</a>
      <a href="https://mydrama.panguplay.in" target="_blank">üé© Shorts</a>
      <a href="https://udai.panguplay.in" target="_blank">üñ•Ô∏è YouDai</a>
      <a href="https://max.panguplay.in" target="_blank">üé≠ Streamify</a>
    </div>
    <div class="nav-right">
      <div class="search-bar">
        <input type="text" placeholder="Search..." id="searchInput">
        <button id="clearButton">‚úñ</button>
      </div>
    </div>
  </div>

  <!-- Mobile Menu Backdrop -->
  <div class="mobile-backdrop" id="mobileBackdrop" onclick="closeMenu()"></div>

  <!-- Mobile Menu -->
  <div class="mobile-menu" id="mobileMenu">
    <button class="close-btn" onclick="closeMenu()">‚úñ</button>
    <a href="index.html">üè† Home</a>
    <a href="movies.html">üé¨ Movies</a>
    <a href="shows.html">üì∫ Shows</a>
    <a href="dubbed.html">üéô Tamil Dub</a>
    <a href="continue.html" selected>‚ñ∂Ô∏è Continue...</a>
    <a href="https://mydrama.panguplay.in" target="_blank">üé© Shorts</a>
    <a href="https://udai.panguplay.in" target="_blank">üñ•Ô∏è YouDai</a>
    <a href="https://max.panguplay.in" target="_blank">üé≠ Streamify</a>
  </div>

  <!-- Page Header -->
  <div class="page-header">
    <h1>Continue Watching</h1>
    <p>Pick up where you left off</p>
  </div>

  <!-- Content Container -->
  <div class="content-container">
    <div id="loadingIndicator" style="display: none;">
      <div class="loader"></div>
    </div>

    <div id="emptyState" class="empty-state" style="display: none;">
      <i class="fas fa-play-circle"></i>
      <h2>No videos in progress</h2>
      <p>Start watching something to see it here</p>
      <a href="index.html">Browse Content</a>
    </div>

    <div class="continue-grid" id="continueGrid"></div>
  </div>

  <footer>
    &copy; 2025 PanguPlay
  </footer>

  <script>
    // Mobile Menu Functions
    function toggleMenu() {
      const menu = document.getElementById('mobileMenu');
      const backdrop = document.getElementById('mobileBackdrop');
      menu.classList.toggle('active');
      backdrop.style.display = menu.classList.contains('active') ? 'block' : 'none';
    }

    function closeMenu() {
      const menu = document.getElementById('mobileMenu');
      const backdrop = document.getElementById('mobileBackdrop');
      menu.classList.remove('active');
      backdrop.style.display = 'none';
    }

    // Splash Screen
    const splash = document.getElementById('splash-screen');
    let splashTimeout = setTimeout(() => {
      if (splash) splash.style.display = 'flex';
    }, 2000);
    
    window.addEventListener('load', () => {
      clearTimeout(splashTimeout);
      if (splash) splash.style.display = 'none';
    });

    // Main App
    let database = [];
    let continueWatching = {};

    async function init() {
      showLoading();
      
      // Load resume data from localStorage
      const saved = localStorage.getItem('playerResume');
      if (saved) {
        try {
          continueWatching = JSON.parse(saved);
        } catch (e) {
          continueWatching = {};
        }
      }

      // Check if there's any data
      if (Object.keys(continueWatching).length === 0) {
        showEmptyState();
        hideLoading();
        return;
      }

      // Load database
      try {
        const response = await fetch('player.json');
        database = await response.json();
        renderContinueWatching();
      } catch (error) {
        console.error('Error loading database:', error);
        showEmptyState();
      }
      
      hideLoading();
    }

    function renderContinueWatching() {
      const grid = document.getElementById('continueGrid');
      grid.innerHTML = '';

      // Convert to array and sort by timestamp (most recent first)
      const entries = Object.entries(continueWatching)
        .map(([id, data]) => ({ id, ...data }))
        .sort((a, b) => b.timestamp - a.timestamp);

      let hasValidItems = false;

      entries.forEach(entry => {
        const { id, time, duration } = entry;
        
        // Skip if watched more than 95% or less than 5 seconds
        const progress = (time / duration) * 100;
        if (progress > 95 || time < 5) return;

        // Find content in database
        const content = findContent(id);
        if (!content) return;

        hasValidItems = true;

        const card = document.createElement('div');
        card.className = 'continue-card';
        card.onclick = () => playContent(id, content);

        const progressPercent = Math.min(progress, 100);
        const timeLeft = formatTimeLeft(duration - time);

        card.innerHTML = `
          <div class="card-image">
            <img src="${content.image}" alt="${content.title}" loading="lazy">
            <div class="play-overlay">
              <i class="fas fa-play"></i>
            </div>
            <div class="progress-bar-container">
              <div class="progress-bar-fill" style="width: ${progressPercent}%"></div>
            </div>
          </div>
          <div class="card-content">
            <div class="card-title">${content.displayTitle}</div>
            <div class="card-info">
              <span>${Math.round(progressPercent)}% watched</span>
              <span>${timeLeft} left</span>
            </div>
          </div>
          <button class="remove-btn" onclick="removeItem(event, '${id}')">
            <i class="fas fa-times"></i>
          </button>
        `;

        grid.appendChild(card);
      });

      if (!hasValidItems) {
        showEmptyState();
      }
    }

    function findContent(id) {
      // Check for direct movie/show match
      let content = database.find(item => item.id === id);
      
      if (content) {
        return {
          ...content,
          displayTitle: content.title,
          playId: id
        };
      }

      // Check for episode match
      for (const item of database) {
        if (item.type === 'series' && item.episodes) {
          const episode = item.episodes.find(ep => ep.id === id);
          if (episode) {
            return {
              ...item,
              displayTitle: `${item.title} - S${episode.season}E${episode.episode}`,
              playId: item.id,
              isEpisode: true
            };
          }
        }
      }

      return null;
    }

    function playContent(resumeId, content) {
      if (content.isEpisode) {
        window.location.href = `player.html?id=${content.playId}`;
      } else {
        window.location.href = `player.html?id=${resumeId}`;
      }
    }

    function removeItem(event, id) {
      event.stopPropagation();
      
      if (confirm('Remove this item from continue watching?')) {
        delete continueWatching[id];
        localStorage.setItem('playerResume', JSON.stringify(continueWatching));
        
        if (Object.keys(continueWatching).length === 0) {
          showEmptyState();
        } else {
          renderContinueWatching();
        }
      }
    }

    function formatTimeLeft(seconds) {
      const hours = Math.floor(seconds / 3600);
      const mins = Math.floor((seconds % 3600) / 60);
      
      if (hours > 0) {
        return `${hours}h ${mins}m`;
      } else if (mins > 0) {
        return `${mins}m`;
      } else {
        return '< 1m';
      }
    }

    function showLoading() {
      document.getElementById('loadingIndicator').style.display = 'block';
      document.getElementById('emptyState').style.display = 'none';
      document.getElementById('continueGrid').style.display = 'none';
    }

    function hideLoading() {
      document.getElementById('loadingIndicator').style.display = 'none';
      document.getElementById('continueGrid').style.display = 'grid';
    }

    function showEmptyState() {
      document.getElementById('emptyState').style.display = 'block';
      document.getElementById('continueGrid').style.display = 'none';
    }

    // Initialize on load
    document.addEventListener('DOMContentLoaded', init);
  </script>
</body>
</html>