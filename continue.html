<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#1f1f1f">
  <link rel="icon" type="image/png" href="https://panguplay.in/favicon.png">
  <title>Continue Watching - PanguPlay</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { background: #121212; color: #fff; font-family: Arial, sans-serif; }
    a { color: inherit; text-decoration: none; }

    .navbar {
      background: #1f1f1f;
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 10px 15px;
      position: sticky;
      top: 0;
      z-index: 1000;
      flex-wrap: wrap;
    }

    .nav-left {
      display: flex;
      align-items: center;
    }

    .nav-logo {
      font-weight: bold;
      font-size: 20px;
      margin-left: 10px;
    }

    .nav-center {
      display: flex;
      gap: 15px;
      align-items: center;
    }

    .nav-center a {
      padding: 5px 10px;
      border-radius: 5px;
      transition: 0.3s;
      font-size: 14px;
    }

    .nav-center a:hover,
    .nav-center a[selected] {
      background: #333;
      color: #ff4500;
    }

    .nav-right {
      display: flex;
      align-items: center;
      margin-left: auto;
    }

    .menu-icon {
      font-size: 24px;
      cursor: pointer;
      display: none;
    }

    .search-bar {
      display: flex;
      align-items: center;
      position: relative;
    }

    .search-bar input {
      padding: 6px 10px;
      border: 1px solid #444;
      background: #2a2a2a;
      color: #fff;
      border-radius: 20px;
      outline: none;
      width: 180px;
      transition: all 0.3s ease;
      padding-right: 30px;
    }

    .search-bar input:focus {
      border-color: #ff4500;
      background: #1e1e1e;
    }

    #clearButton {
      position: absolute;
      right: 8px;
      background: none;
      border: none;
      color: #aaa;
      cursor: pointer;
      font-size: 14px;
      display: none;
    }

    .search-results {
      position: absolute;
      top: 110%;
      background: #2a2a2a;
      width: 200px;
      border-radius: 8px;
      overflow: hidden;
      display: none;
      right: 0;
    }

    .search-results div {
      padding: 10px;
      border-bottom: 1px solid #444;
      cursor: pointer;
    }

    .search-results div:hover {
      background: #333;
    }

    .mobile-backdrop {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.5);
      backdrop-filter: blur(4px);
      z-index: 1999;
      display: none;
    }

    .mobile-menu {
      position: fixed;
      top: 0;
      left: -100%;
      width: 250px;
      height: 100%;
      background: #202020;
      display: flex;
      flex-direction: column;
      padding: 20px;
      transition: left 0.3s ease;
      z-index: 2000;
      box-shadow: 5px 0 15px rgba(0,0,0,0.2);
      border-right: 2px solid #333;
    }

    .mobile-menu.open {
      left: 0;
    }

    .mobile-menu a {
      margin: 15px 0;
      font-size: 18px;
      color: #fff;
      padding: 10px;
      border-radius: 8px;
      transition: background 0.2s;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .mobile-menu a:hover,
    .mobile-menu a[selected] {
      background: #2a2a2a;
    }

    .close-btn {
      font-size: 22px;
      color: #fff;
      background: none;
      border: none;
      align-self: flex-end;
      margin-bottom: 20px;
      cursor: pointer;
    }

    .section {
      padding: 20px 15px;
    }

    .section h2 {
      margin-bottom: 15px;
      font-size: 18px;
    }

    .cards {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
      gap: 15px;
    }

    .card {
      background: #1f1f1f;
      border-radius: 10px;
      overflow: hidden;
      transition: 0.3s;
      font-size: 12px;
      text-align: center;
      cursor: pointer;
      position: relative;
    }

    .card:hover {
      transform: scale(1.05);
    }

    .card-image-container {
      position: relative;
    }

    .card img {
      width: 100%;
      height: 180px;
      object-fit: cover;
      border-radius: 10px 10px 0 0;
    }

    .progress-indicator {
      position: absolute;
      bottom: 0;
      left: 0;
      right: 0;
      height: 4px;
      background: rgba(255, 255, 255, 0.2);
    }

    .progress-fill {
      height: 100%;
      background: #ff4500;
      transition: width 0.3s;
    }

    .watch-info {
      position: absolute;
      top: 10px;
      left: 10px;
      background: rgba(0, 0, 0, 0.8);
      color: white;
      padding: 4px 8px;
      border-radius: 4px;
      font-size: 11px;
      font-weight: bold;
      z-index: 5;
    }

    .remove-btn {
      position: absolute;
      top: 10px;
      right: 10px;
      width: 28px;
      height: 28px;
      background: rgba(0, 0, 0, 0.8);
      border: none;
      border-radius: 50%;
      color: #fff;
      cursor: pointer;
      display: none;
      align-items: center;
      justify-content: center;
      font-size: 16px;
      z-index: 10;
      transition: background 0.2s;
    }

    .card:hover .remove-btn {
      display: flex;
    }

    .remove-btn:hover {
      background: #ff4500;
    }

    .card-title {
      padding: 8px 5px;
      font-weight: bold;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .time-left {
      padding: 0 5px 8px 5px;
      font-size: 11px;
      color: #aaa;
    }

    .placeholder-image {
      position: relative;
      background: linear-gradient(135deg, #1f1f1f 0%, #303030 100%);
      height: 180px;
      display: flex;
      align-items: center;
      justify-content: center;
      overflow: hidden;
      border-radius: 10px 10px 0 0;
    }

    .placeholder-icon {
      font-size: 50px;
      opacity: 0.5;
    }

    .empty-state {
      text-align: center;
      padding: 60px 20px;
    }

    .empty-state-icon {
      font-size: 80px;
      opacity: 0.3;
      margin-bottom: 20px;
    }

    .empty-state h2 {
      font-size: 24px;
      margin-bottom: 10px;
      color: #999;
    }

    .empty-state p {
      color: #666;
      margin-bottom: 20px;
    }

    .empty-state a {
      display: inline-block;
      padding: 12px 30px;
      background: #ff4500;
      color: #fff;
      text-decoration: none;
      border-radius: 25px;
      transition: background 0.3s;
    }

    .empty-state a:hover {
      background: #e03e00;
    }

    footer {
      text-align: center;
      padding: 20px;
      font-size: 14px;
      background: #1f1f1f;
      margin-top: 20px;
    }

    #backToTopBtn {
      display: none;
      position: fixed;
      bottom: 30px;
      right: 30px;
      z-index: 99;
      border: none;
      outline: none;
      background-color: #1a365d;
      color: white;
      cursor: pointer;
      padding: 15px;
      border-radius: 50%;
      font-size: 18px;
      width: 50px;
      height: 50px;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
      transition: background-color 0.3s, transform 0.3s;
    }

    #backToTopBtn:hover {
      background-color: #0f2042;
      transform: translateY(-3px);
    }

    #backToTopBtn::after {
      content: "‚Üë";
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
    }

    .loader {
      width: 40px;
      height: 40px;
      border: 4px solid #ffffff33;
      border-top: 4px solid #ffffff;
      border-radius: 50%;
      animation: spin 1s linear infinite;
      margin: 40px auto;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    @media(max-width:768px) {
      .nav-center { display: none; }
      .menu-icon { display: block; }
      .cards { grid-template-columns: repeat(3, 1fr); }
      .search-bar input { width: 140px; }
    }
  </style>
</head>
<body>
  <div id="splash-screen" style="position:fixed;top:0;left:0;width:100%;height:100%;background:#121212;display:none;flex-direction:column;justify-content:center;align-items:center;z-index:9999;">
    <img src="favicon.png" alt="Loading..." style="width:100px;height:auto;margin-bottom:20px;">
    <div class="loader"></div>
  </div>

  <!-- Navbar -->
  <div class="navbar">
    <div class="nav-left">
      <div class="menu-icon" onclick="toggleMenu()">&#9776;</div>
      <a href="index.html" class="nav-logo">PanguPlay</a>
    </div>
    <div class="nav-center nav-links">
      <a href="index.html">Home</a>
      <a href="movies.html">Movies</a>
      <a href="shows.html">Shows</a>
      <a href="dubbed.html">Tamil Dub</a>
      <a href="continue.html" selected>History</a>
      <a href="https://mydrama.panguplay.in" target="_blank">üé© Shorts</a>
      <a href="https://udai.panguplay.in" target="_blank">üñ•Ô∏è YouDai</a>
      <a href="https://max.panguplay.in" target="_blank">üé≠ Streamify</a>
    </div>
    <div class="nav-right">
      <div class="search-bar">
        <input type="text" placeholder="Search..." id="searchInput">
        <button id="clearButton">‚úñ</button>
        <div class="search-results" id="searchResults"></div>
      </div>
    </div>
  </div>

  <!-- Mobile Menu Backdrop -->
  <div class="mobile-backdrop" id="mobileBackdrop" onclick="closeMenu()"></div>

  <!-- Mobile Menu -->
  <div class="mobile-menu" id="mobileMenu">
    <button class="close-btn" onclick="closeMenu()">‚úñ</button>
    <a href="index.html">üè† Home</a>
    <a href="movies.html">üé¨ Movies</a>
    <a href="shows.html">üì∫ Shows</a>
    <a href="dubbed.html">üéô Tamil Dub</a>
    <a href="continue.html" selected>‚ñ∂Ô∏è History</a>
    <a href="https://mydrama.panguplay.in" target="_blank">üé© Shorts</a>
    <a href="https://udai.panguplay.in" target="_blank">üñ•Ô∏è YouDai</a>
    <a href="https://max.panguplay.in" target="_blank">üé≠ Streamify</a>
  </div>

  <!-- Main Content -->
  <div class="section">
    <h2>Continue Watching</h2>
    
    <div id="loadingIndicator" style="display: none;">
      <div class="loader"></div>
    </div>

    <div id="emptyState" class="empty-state" style="display: none;">
      <div class="empty-state-icon">‚ñ∂Ô∏è</div>
      <h2>No videos in progress</h2>
      <p>Start watching something to see it here</p>
      <a href="index.html">Browse Content</a>
    </div>

    <div class="cards" id="continueGrid"></div>
  </div>

  <!-- Back to top button -->
  <button id="backToTopBtn" title="Go to top"></button>

  <footer>
    &copy; 2025 PanguPlay
  </footer>
  
  <div id="gestureZone" style="position: fixed; top: 0; left: 0; height: 100%; width: 30px; z-index: 3000;"></div>
  
  <script disable-devtool-auto='true'
src='https://cdn.jsdelivr.net/npm/disable-devtool'
clear-log='true'
disable-select='true' 
disable-copy='true'
disable-cut='true' 
disable-paste='false'>
</script>

  <script>
    // Mobile Menu Functions
    function toggleMenu() {
      const menu = document.getElementById('mobileMenu');
      const backdrop = document.getElementById('mobileBackdrop');
      menu.classList.toggle('open');
      backdrop.style.display = menu.classList.contains('open') ? 'block' : 'none';
    }

    function closeMenu() {
      const menu = document.getElementById('mobileMenu');
      const backdrop = document.getElementById('mobileBackdrop');
      menu.classList.remove('open');
      backdrop.style.display = 'none';
    }

    // Splash Screen
    const splash = document.getElementById('splash-screen');
    let splashTimeout = setTimeout(() => {
      if (splash) splash.style.display = 'flex';
    }, 2000);
    
    window.addEventListener('load', () => {
      clearTimeout(splashTimeout);
      if (splash) splash.style.display = 'none';
    });

    // Back to Top Button
    const backToTopBtn = document.getElementById('backToTopBtn');
    window.onscroll = function() {
      if (document.body.scrollTop > 200 || document.documentElement.scrollTop > 200) {
        backToTopBtn.style.display = 'block';
      } else {
        backToTopBtn.style.display = 'none';
      }
    };
    backToTopBtn.onclick = function() {
      window.scrollTo({ top: 0, behavior: 'smooth' });
    };

    // Main App
    let database = [];
    let continueWatching = {};

    async function init() {
      showLoading();
      
      // Load resume data from localStorage
      const saved = localStorage.getItem('playerResume');
      if (saved) {
        try {
          continueWatching = JSON.parse(saved);
        } catch (e) {
          continueWatching = {};
        }
      }

      // Check if there's any data
      if (Object.keys(continueWatching).length === 0) {
        showEmptyState();
        hideLoading();
        return;
      }

      // Load database
      try {
        const response = await fetch('player.json');
        database = await response.json();
        renderContinueWatching();
      } catch (error) {
        console.error('Error loading database:', error);
        showEmptyState();
      }
      
      hideLoading();
    }

    function renderContinueWatching() {
      const grid = document.getElementById('continueGrid');
      grid.innerHTML = '';

      // Convert to array and sort by timestamp (most recent first)
      const entries = Object.entries(continueWatching)
        .map(([id, data]) => ({ id, ...data }))
        .sort((a, b) => b.timestamp - a.timestamp);

      let hasValidItems = false;

      entries.forEach(entry => {
        const { id, time, duration } = entry;
        
        // Skip if watched more than 95% or less than 5 seconds
        const progress = (time / duration) * 100;
        if (progress > 95 || time < 5) return;

        // Find content in database
        const content = findContent(id);
        if (!content) return;

        hasValidItems = true;

        const card = document.createElement('div');
        card.className = 'card';
        card.onclick = (e) => {
          if (!e.target.closest('.remove-btn')) {
            playContent(id, content);
          }
        };

        const progressPercent = Math.min(progress, 100);
        const timeLeft = formatTimeLeft(duration - time);

        card.innerHTML = `
          <div class="card-image-container">
            <img src="${content.image}" alt="${content.title}" loading="lazy" onerror="this.parentElement.innerHTML='<div class=\\'placeholder-image\\'><div class=\\'placeholder-icon\\'>üé¨</div></div>'">
            <div class="watch-info">${Math.round(progressPercent)}%</div>
            <button class="remove-btn" onclick="removeItem(event, '${id}')">‚úñ</button>
            <div class="progress-indicator">
              <div class="progress-fill" style="width: ${progressPercent}%"></div>
            </div>
          </div>
          <div class="card-title">${content.displayTitle}</div>
          <div class="time-left">${timeLeft} left</div>
        `;

        grid.appendChild(card);
      });

      if (!hasValidItems) {
        showEmptyState();
      }
    }

    function findContent(id) {
      // Check for direct movie/show match
      let content = database.find(item => item.id === id);
      
      if (content) {
        return {
          ...content,
          displayTitle: content.title,
          playId: id
        };
      }

      // Check for episode match
      for (const item of database) {
        if (item.type === 'series' && item.episodes) {
          const episode = item.episodes.find(ep => ep.id === id);
          if (episode) {
            return {
              ...item,
              displayTitle: `${item.title} - S${episode.season}E${episode.episode}`,
              playId: item.id,
              isEpisode: true
            };
          }
        }
      }

      return null;
    }

    function playContent(resumeId, content) {
      if (content.isEpisode) {
        window.location.href = `player.html?id=${content.playId}`;
      } else {
        window.location.href = `player.html?id=${resumeId}`;
      }
    }

    function removeItem(event, id) {
      event.stopPropagation();
      
      if (confirm('Remove this item from continue watching?')) {
        delete continueWatching[id];
        localStorage.setItem('playerResume', JSON.stringify(continueWatching));
        
        if (Object.keys(continueWatching).length === 0) {
          showEmptyState();
        } else {
          renderContinueWatching();
        }
      }
    }

    function formatTimeLeft(seconds) {
      const hours = Math.floor(seconds / 3600);
      const mins = Math.floor((seconds % 3600) / 60);
      
      if (hours > 0) {
        return `${hours}h ${mins}m`;
      } else if (mins > 0) {
        return `${mins}m`;
      } else {
        return '< 1m';
      }
    }

    function showLoading() {
      document.getElementById('loadingIndicator').style.display = 'block';
      document.getElementById('emptyState').style.display = 'none';
      document.getElementById('continueGrid').style.display = 'none';
    }

    function hideLoading() {
      document.getElementById('loadingIndicator').style.display = 'none';
      document.getElementById('continueGrid').style.display = 'grid';
    }

    function showEmptyState() {
      document.getElementById('emptyState').style.display = 'block';
      document.getElementById('continueGrid').style.display = 'none';
    }

    // Initialize on load
    document.addEventListener('DOMContentLoaded', init);
  </script>
  
<script>

const gestureZone = document.getElementById('gestureZone');

gestureZone.addEventListener('touchstart', (e) => {
  touchStartX = e.changedTouches[0].screenX;
});

gestureZone.addEventListener('touchend', (e) => {
  touchEndX = e.changedTouches[0].screenX;
  if (touchEndX - touchStartX > 60) {
    toggleMenu();
  }
});

</script>  
  
<script src="/orientation-lock.js"></script>

<script>
  if ('serviceWorker' in navigator) {
    window.addEventListener('load', () => {
      navigator.serviceWorker.register('/service-worker.js')
        .then(registration => {
          console.log('Service Worker registered with scope:', registration.scope);
        })
        .catch(error => {
          console.error('Service Worker registration failed:', error);
        });
    });
  }
</script>
  
</body>
</html>